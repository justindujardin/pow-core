
/*!
  pow-core - v0.2.1
  built: 2015-11-28
 */

System.registerDynamic("pow-core/errors.js",[],!0,function(a,b,c){var d=this,e=d.define;return d.define=void 0,b.errors={INVALID_ARGUMENTS:"invalid arguments",DIVIDE_ZERO:"divide by zero operation",CLASS_NOT_IMPLEMENTED:"must be implemented in a subclass",UNSUPPORTED_OPERATION:"this operation is unsupported by the implementation",REQUIRED_ARGUMENT:"argument must be valid",ALREADY_EXISTS:"already exists and would overwrite existing value",INDEX_OUT_OF_RANGE:"index out of range",INVALID_ITEM:"invalid item type or value",COMPONENT_REGISTER_FAIL:"component failed to register with host entity"},d.define=e,c.exports}),System.registerDynamic("pow-core/api.js",["pow-core/errors.js"],!0,function(a,b,c){function d(a){return k[a]}function e(a,b){if(!a)throw new Error(j.errors.REQUIRED_ARGUMENT);if(k.hasOwnProperty(a))throw new Error(j.errors.ALREADY_EXISTS);return k[a]=b,k[a]}function f(a){if(!a)throw new Error(j.errors.REQUIRED_ARGUMENT);if(!k.hasOwnProperty(a))throw new Error(j.errors.INVALID_ARGUMENTS);var b=k[a];return delete k[a],b}function g(){k={}}var h=this,i=h.define;h.define=void 0;var j=a("pow-core/errors.js"),k={};return b.getWorld=d,b.registerWorld=e,b.unregisterWorld=f,b.clearWorlds=g,h.define=i,c.exports}),System.registerDynamic("pow-core/component.js",[],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=function(){function a(){this.id=_.uniqueId("sc")}return a.prototype.connectComponent=function(){return!0},a.prototype.disconnectComponent=function(){return!0},a.prototype.syncComponent=function(){return!0},a.prototype.toString=function(){var a=this.constructor,b=a?a.toString().match(/function (.+?)\(/):null;return a&&a.name?a.name:b&&b[1]?b[1]:this.name},a}();return b.Component=f,d.define=e,c.exports}),System.registerDynamic("pow-core/entity.js",["pow-core/errors.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=a("pow-core/errors.js"),g=function(){function a(){this._components=[]}return a.prototype.destroy=function(){_.each(this._components,function(a){a.disconnectComponent()}),this._components.length=0},a.prototype.findComponent=function(a){for(var b=this._components,c=this._components.length,d=0;c>d;d++){var e=b[d];if(e instanceof a)return e}return null},a.prototype.findComponents=function(a){for(var b=this._components,c=[],d=this._components.length,e=0;d>e;e++){var f=b[e];f instanceof a&&c.push(f)}return c},a.prototype.findComponentByName=function(a){for(var b=this._components,c=this._components.length,d=0;c>d;d++){var e=b[d];if(e.name===a)return e}return null},a.prototype.syncComponents=function(){for(var a=this._components,b=this._components.length,c=0;b>c;c++)a[c].syncComponent()},a.prototype.addComponent=function(a,b){if(_.where(this._components,{id:a.id}).length>0)throw new Error(f.errors.ALREADY_EXISTS);return a.host=this,a.connectComponent()===!1?(delete a.host,!1):(this._components.push(a),b!==!0&&this.syncComponents(),!0)},a.prototype.removeComponentByType=function(a,b){void 0===b&&(b=!1);var c=this.findComponent(a);return c?this.removeComponent(c,b):!1},a.prototype.removeComponent=function(a,b){void 0===b&&(b=!1);var c=this._components.length;this._components=_.filter(this._components,function(b){return b.id===a.id?b.disconnectComponent()===!1?!0:(b.host=null,!1):!0});var d=this._components.length!==c;return d&&b!==!0&&this.syncComponents(),d},a}();return b.Entity=g,d.define=e,c.exports}),System.registerDynamic("pow-core/observable.js",[],!0,function(a,b,c){function d(a){return!!a&&"object"==typeof a&&"[object Array]"!==Object.prototype.toString.call(a)}var e=this,f=e.define;e.define=void 0,b.isObject=d;var g=function(){function a(){this._listeners=[]}return a.prototype.subscribe=function(a){var b=this;if(!a||!d(a))return null;var c=!1;return this._listeners.push(a),{unsubscribe:function(){c||(c=!0,b._removeGenerator(a))}}},a.prototype.next=function(a){return this._execute("next",a)},a.prototype["throw"]=function(a){return this._execute("throw",a)},a.prototype["return"]=function(a){return this._execute("return",a)},a.prototype._execute=function(a,b){for(var c=this,d=[],e=0;e<this._listeners.length;e++)try{var f=this._listeners[e];if(!f||!f[a])continue;var g=f[a](b);g&&g.done===!0&&d.push(this._listeners[e])}catch(h){"throw"===a?console.error("Error thrown in error handler: ",h):this["throw"](h);break}d.length&&d.forEach(function(a){return c._removeGenerator(a)})},a.prototype._removeGenerator=function(a){for(var b=0;b<this._listeners.length;b++)if(this._listeners[b]===a)return void this._listeners.splice(b,1)},a}();return b.Observable=g,e.define=f,c.exports}),System.registerDynamic("pow-core/point.js",["pow-core/errors.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=a("pow-core/errors.js"),g=function(){function a(b,c){b instanceof a?this.set(b.x,b.y):"string"==typeof b&&"string"==typeof c?this.set(parseFloat(b),parseFloat(c)):"number"==typeof b&&"number"==typeof c?this.set(b,c):this.zero()}return a.prototype.toString=function(){return""+this.x+","+this.y},a.prototype.set=function(b,c){if(b instanceof a)this.x=b.x,this.y=b.y;else{if("number"!=typeof b||"number"!=typeof c)throw new Error(f.errors.INVALID_ARGUMENTS);this.x=b,this.y=c}return this},a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},a.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},a.prototype.add=function(b,c){return b instanceof a?(this.x+=b.x,this.y+=b.y):"number"==typeof b&&"undefined"==typeof c?(this.x+=b,this.y+=b):(this.x+=b,this.y+=c),this},a.prototype.subtract=function(b,c){return b instanceof a?(this.x-=b.x,this.y-=b.y):"number"==typeof b&&"undefined"==typeof c?(this.x-=b,this.y-=b):(this.x-=b,this.y-=c),this},a.prototype.multiply=function(b,c){return b instanceof a?(this.x*=b.x,this.y*=b.y):"number"==typeof b&&"undefined"==typeof c?(this.x*=b,this.y*=b):(this.x*=b,this.y*=c),this},a.prototype.divide=function(b,c){if(b instanceof a){if(0===b.x||0===b.y)throw new Error(f.errors.DIVIDE_ZERO);this.x/=b.x,this.y/=b.y}else if("number"==typeof b&&"undefined"==typeof c){if(0===b)throw new Error(f.errors.DIVIDE_ZERO);this.x/=b,this.y/=b}else{if(0===b||0===c)throw new Error(f.errors.DIVIDE_ZERO);this.x/=b,this.y/=c}return this},a.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this},a.prototype.equal=function(a){return this.x===a.x&&this.y===a.y},a.prototype.isZero=function(){return 0===this.x&&0===this.y},a.prototype.zero=function(){return this.x=this.y=0,this},a.prototype.interpolate=function(a,b,c){return c=Math.min(Math.max(c,0),1),this.x=a.x*(1-c)+b.x*c,this.y=a.y*(1-c)+b.y*c,this},a}();return b.Point=g,d.define=e,c.exports}),System.registerDynamic("pow-core/rect.js",["pow-core/errors.js","pow-core/point.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=a("pow-core/errors.js"),g=a("pow-core/point.js"),h=function(){function a(b,c,d,e){return b instanceof a?(this.point=new g.Point(b.point),this.extent=new g.Point(b.extent)):"number"==typeof d&&"number"==typeof e?(this.point=new g.Point(b,c),this.extent=new g.Point(d,e)):b instanceof g.Point&&c instanceof g.Point?(this.point=new g.Point(b),this.extent=new g.Point(c)):(this.point=new g.Point(0,0),this.extent=new g.Point(1,1)),this}return a.prototype.toString=function(){return this.point.toString()+","+this.extent.toString()},a.prototype.set=function(b,c,d,e){if(b instanceof a)this.point.set(b.point),this.extent.set(b.extent);else if("number"==typeof d&&"number"==typeof e)this.point.set(b,c),this.extent.set(d,e);else{if(!(b instanceof g.Point&&c instanceof g.Point))throw new Error(f.errors.INVALID_ARGUMENTS);this.point.set(b),this.extent.set(c)}return this},a.prototype.clone=function(){return new a(this.point.clone(),this.extent.clone())},a.prototype.clip=function(a){var b=this.point.x+this.extent.x,c=this.point.y+this.extent.y;return this.point.x=Math.max(a.point.x,this.point.x),this.extent.x=Math.min(a.point.x+a.extent.x,b)-this.point.x,this.point.y=Math.max(a.point.y,this.point.y),this.extent.y=Math.min(a.point.y+a.extent.y,c)-this.point.y,this},a.prototype.isValid=function(){return this.extent.x>0&&this.extent.y>0},a.prototype.intersect=function(a){return!(a.point.x>this.point.x+this.extent.x||a.point.x+a.extent.x<this.point.x||a.point.y>this.point.y+this.extent.y||a.point.y+a.extent.y<this.point.y)},a.prototype.pointInRect=function(a,b){var c=0;if(a instanceof g.Point)c=a.x,b=a.y;else{if("number"!=typeof a||"number"!=typeof b)throw new Error(f.errors.INVALID_ARGUMENTS);c=a}return c>=this.point.x+this.extent.x||b>=this.point.y+this.extent.y?!1:!(c<this.point.x||b<this.point.y)},a.prototype.getCenter=function(){var a=parseFloat((this.point.x+.5*this.extent.x).toFixed(2)),b=parseFloat((this.point.y+.5*this.extent.y).toFixed(2));return new g.Point(a,b)},a.prototype.setCenter=function(a,b){var c;return a instanceof g.Point?(c=a.x,b=a.y):c=a,this.point.x=parseFloat((c-.5*this.extent.x).toFixed(2)),this.point.y=parseFloat((b-.5*this.extent.y).toFixed(2)),this},a.prototype.getLeft=function(){return this.point.x},a.prototype.getTop=function(){return this.point.y},a.prototype.getRight=function(){return this.point.x+this.extent.x},a.prototype.getBottom=function(){return this.point.y+this.extent.y},a.prototype.getHalfSize=function(){return new g.Point(this.extent.x/2,this.extent.y/2)},a.prototype.addPoint=function(a){a.x<this.point.x&&(this.extent.x=this.extent.x-(a.x-this.point.x),this.point.x=a.x),a.y<this.point.y&&(this.extent.y=this.extent.y-(a.x-this.point.y),this.point.y=a.y),a.x>this.point.x+this.extent.x&&(this.extent.x=a.x-this.point.x),a.y>this.point.y+this.extent.y&&(this.extent.y=a.y-this.point.y)},a.prototype.inflate=function(a,b){return void 0===a&&(a=1),void 0===b&&(b=1),this.point.x-=a,this.extent.x+=2*a,this.point.y-=b,this.extent.y+=2*b,this},a}();return b.Rect=h,d.define=e,c.exports}),System.registerDynamic("pow-core/resource.js",["pow-core/errors.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=a("pow-core/errors.js"),g=function(){function a(a,b){void 0===a&&(a=null),void 0===b&&(b=null),this.url=a,this.data=b}return a.prototype.load=function(a){return Promise.reject(f.errors.CLASS_NOT_IMPLEMENTED)},a.prototype.fetch=function(a){return Promise.reject(f.errors.CLASS_NOT_IMPLEMENTED)},a}();return b.Resource=g,d.define=e,c.exports}),System.registerDynamic("pow-core/resources/image.js",["pow-core/resource.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=a("pow-core/resource.js"),h=function(a){function b(){a.apply(this,arguments)}return f(b,a),b.prototype.fetch=function(a){var b=this;return this.url=a||this.url,new Promise(function(a,c){var d=new Image;d.onload=function(){b.data=d,a(b)},d.onerror=function(a){c(a)},d.src=b.url})},b}(g.Resource);return b.ImageResource=h,d.define=e,c.exports}),System.registerDynamic("pow-core/resources/script.js",["pow-core/resource.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=a("pow-core/resource.js"),h=function(a){function b(){a.apply(this,arguments)}return f(b,a),b.prototype.fetch=function(a){var b=this;return this.url=a||this.url,new Promise(function(a,c){var d=$.getScript(b.url);d.done(function(c){b.data=c,a(b)}),d.fail(function(a,b,d){c(d)})})},b}(g.Resource);return b.ScriptResource=h,d.define=e,c.exports}),System.registerDynamic("pow-core/resources/json.js",["pow-core/resource.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=a("pow-core/resource.js"),h=function(a){function b(){a.apply(this,arguments)}return f(b,a),b.prototype.fetch=function(a){var b=this;return this.url=a||this.url,new Promise(function(a,c){var d=$.getJSON(b.url);d.done(function(c){b.data=c,a(b)}),d.fail(function(a,b,d){c(d)})})},b}(g.Resource);return b.JSONResource=h,d.define=e,c.exports}),System.registerDynamic("pow-core/resources/xml.js",["pow-core/resource.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=a("pow-core/resource.js"),h=function(a){function b(){a.apply(this,arguments)}return f(b,a),b.prototype.fetch=function(a){var b=this;return this.url=a||this.url,new Promise(function(a,c){var d=$.get(b.url);d.done(function(d){b.data=$(d),b.load(b.data).then(a)["catch"](c)}),d.fail(function(a,b,d){c(d)})})},b.prototype.load=function(a){return Promise.resolve(this)},b.prototype.getRootNode=function(a){return this.data?$(_.find(this.data,function(b){return b.tagName&&b.tagName.toLowerCase()===a})):null},b.prototype.getChildren=function(a,b){var c=a.find(b);return _.compact(_.map(c,function(b){var c=$(b);return c.parent()[0]!==a[0]?null:c}))},b.prototype.getChild=function(a,b){return this.getChildren(a,b)[0]},b.prototype.getElAttribute=function(a,b){if(a){var c=a.attr(b);if(c)return c}return null},b}(g.Resource);return b.XMLResource=h,d.define=e,c.exports}),System.registerDynamic("pow-core/resources/entities.js",["pow-core/resources/json.js","pow-core/errors.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=a("pow-core/resources/json.js"),h=a("pow-core/errors.js");!function(a){a[a.NONE=0]="NONE",a[a.ENTITY_TYPE=1]="ENTITY_TYPE",a[a.COMPONENT_TYPE=2]="COMPONENT_TYPE",a[a.COMPONENT_NAME_DUPLICATE=4]="COMPONENT_NAME_DUPLICATE",a[a.COMPONENT_REGISTER=8]="COMPONENT_REGISTER",a[a.COMPONENT_INPUT=16]="COMPONENT_INPUT",a[a.INPUT_NAME=32]="INPUT_NAME",a[a.INPUT_TYPE=64]="INPUT_TYPE"}(b.EntityError||(b.EntityError={}));var i=b.EntityError,j=function(a){function b(){a.apply(this,arguments)}return f(b,a),b.prototype.createObject=function(a,b){var c=this,d=this.getTemplate(a);return d?this.validateTemplate(d,b).then(function(){return c._fetchImportModule(d.type)}).then(function(a){var e=d.params?_.map(d.params,function(a){return b[a]}):[b],f=c.constructObject(a,e);return Promise.all(_.map(d.components,function(a){return new Promise(function(d,e){var g=_.map(a.params||[],function(a){return b[a]});c._fetchImportModule(a.type).then(function(b){var i=c.constructObject(b,g);i.name=a.name,f.addComponent(i)||e(h.errors.COMPONENT_REGISTER_FAIL),d(i)})["catch"](e)})})).then(function(){return f})["catch"](function(){return null})}):Promise.reject("invalid template")},b.prototype.validateTemplate=function(a,b){var c=this;return new Promise(function(d,e){c._fetchImportModule(a.type).then(function(d){if(!d)return e(i.ENTITY_TYPE);if(a.inputs){var f=_.keys(a.inputs);if(f){if("undefined"==typeof b)return console.error("EntityContainer: missing inputs for template that requires: "+f.join(", ")),e(i.INPUT_NAME);var g=function(a,d){return new Promise(function(e,f){return c._fetchImportModule(a).then(function(a){"undefined"==typeof b[d]?(console.error("EntityContainer: missing input with name: "+d),f(i.INPUT_NAME)):!a||b[d]instanceof a||(console.error("EntityContainer: bad input type for input: "+d),f(i.INPUT_TYPE)),e(a)})["catch"](function(){c.typeofCompare(b[d],a)||(console.error("EntityContainer: bad input type for input ("+d+") expected ("+a+") but got ("+typeof b[d]+")"),f(i.INPUT_TYPE)),e()})})};return Promise.all(_.map(a.inputs,g))["catch"](function(a){return e(a)})}}}).then(function(){if(a.components){var b=_.map(a.components,function(a){return a.name}),c=_.uniq(b).length===b.length;if(!c)return console.error("EntityContainer: duplicate name in template components: "+b.join(", ")),e(i.COMPONENT_NAME_DUPLICATE)}}).then(function(){return Promise.all(_.map(a.components,function(a){return c._fetchImportModule(a.type)})).then(function(){var c=i.NONE;_.each(a.components,function(a){a.params&&_.each(a.params,function(a){"undefined"==typeof b[a]&&(console.error("EntityContainer: missing component param: "+a),c|=i.COMPONENT_INPUT)})}),c!==i.NONE&&e(c)})["catch"](function(){return e(i.COMPONENT_TYPE)})}).then(function(){return d()})})},b.prototype.getTemplate=function(a){if(!this.data)return null;var b=_.where(this.data,{name:a})[0];return b?b:null},b.prototype.constructObject=function(a,b){var c=[null].concat(b),d=a.bind.apply(a,c);return new d},b.prototype.typeofCompare=function(a,b){var c=typeof a,b=""+b;return c.toUpperCase()===b.toUpperCase()},b.prototype._fetchImportModule=function(a){var c=a.split(b.IMPORT_SPLITTER);if(2!==c.length)return Promise.reject("import type ("+a+') must be of format "path|typename"');var d=c[0],e=c[1];return new Promise(function(c,f){System["import"](d).then(function(g){g[e]||f("INVALID MODULE TYPE: "+d),b._typesCache[a]=g[e],c(g[e])})["catch"](function(a){f("INVALID MODULE: "+d+" - "+a)})})},b.IMPORT_SPLITTER="|",b._typesCache={},b}(g.JSONResource);return b.EntityContainerResource=j,d.define=e,c.exports}),System.registerDynamic("pow-core/resources/tiled/tiled.js",[],!0,function(a,b,c){function d(a){return{name:q(a,"name"),x:parseInt(q(a,"x")||"0"),y:parseInt(q(a,"y")||"0"),width:parseInt(q(a,"width")||"0"),height:parseInt(q(a,"height")||"0"),visible:1===parseInt(q(a,"visible")||"1"),_xml:a}}function e(a,b){p(a,"name",b.name),b.type&&p(a,"type",b.type),0!==b.x&&p(a,"x",b.x),0!==b.y&&p(a,"y",b.y),p(a,"width",b.width),p(a,"height",b.height),b.visible===!1&&p(a,"visible",b.visible),"undefined"!=typeof b.color&&p(a,"color",b.color)}function f(a,b){e(a,b)}function g(a){var b=h(a),c=q(a,"type");return c&&(b.type=c),b}function h(a){var b=d(a);b.opacity=parseInt(q(a,"opacity")||"1");var c=l(a);return c&&(b.properties=c),b}function i(a,b){var c=a.split("/"),d=b.split("/");c.pop();for(var e=0;e<d.length;e++)"."!=d[e]&&(".."==d[e]?c.pop():c.push(d[e]));return c.join("/")}function j(a){try{return(new XMLSerializer).serializeToString(a)}catch(b){try{return a.xml}catch(b){throw new Error("Xmlserializer not supported")}}}function k(a,b){e(a,b),p(a,"opacity",b.opacity),m(a,b.properties)}function l(a){var b=o(a,"properties");if(b&&b.length>0){var c={},d=n(b,"property");return _.each(d,function(a){var b=q(a,"name"),d=q(a,"value");if("string"==typeof d){var e=d.toLowerCase();"true"===e||"false"===e?d="true"===e:isNaN(e=parseFloat(d))||(d=e)}c[b]=d}),c}return null}function m(a,b){var c=$("<properties/>");_.each(b,function(a,b){var d=$("<property/>");p(d,"name",b),p(d,"value",a),c.append(d)}),c.children().length>0&&a.append(c)}function n(a,b){var c=a.find(b);return _.compact(_.map(c,function(b){var c=$(b);return c.parent()[0]!==a[0]?null:c}))}function o(a,b){return n(a,b)[0]}function p(a,b,c){a.attr(b,c)}function q(a,b){return a.attr(b)||null}var r=this,s=r.define;return r.define=void 0,b.readITiledBase=d,b.writeITiledBase=e,b.writeITiledObjectBase=f,b.readITiledObject=g,b.readITiledLayerBase=h,b.compactUrl=i,b.xml2Str=j,b.writeITiledLayerBase=k,b.readTiledProperties=l,b.writeTiledProperties=m,b.getChildren=n,b.getChild=o,b.setElAttribute=p,b.getElAttribute=q,r.define=s,c.exports}),System.registerDynamic("pow-core/resources/tiled/tiledTsx.js",["pow-core/resources/tiled/tiled.js","pow-core/resources/xml.js","pow-core/resources/image.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=a("pow-core/resources/tiled/tiled.js"),h=a("pow-core/resources/xml.js"),i=a("pow-core/resources/image.js"),j=function(){function a(a){this.properties={},this.id=a}return a}();b.TilesetTile=j;var k=function(a){function b(){a.apply(this,arguments),this.name=null,this.tilewidth=16,this.tileheight=16,this.imageWidth=0,this.imageHeight=0,this.image=null,this.firstgid=-1,this.tiles=[],this.relativeTo=null,this.imageUrl=null,this.literal=null}return f(b,a),b.prototype.load=function(a){var b=this;return this.data=a||this.data,new Promise(function(a,c){var d=b.getRootNode("tileset");b.name=b.getElAttribute(d,"name"),b.tilewidth=parseInt(b.getElAttribute(d,"tilewidth")),b.tileheight=parseInt(b.getElAttribute(d,"tileheight"));var e=b.url?b.url.substr(0,b.url.lastIndexOf("/")+1):"",f=b.getChildren(d,"tile");_.each(f,function(a){var c=parseInt(b.getElAttribute(a,"id")),d=new j(c);d.properties=g.readTiledProperties(a),b.tiles.push(d)});var h=b.getChild(d,"img");if(!h||0===h.length)return a(b);var k=b.getElAttribute(h,"source");b.imageWidth=parseInt(b.getElAttribute(h,"width")||"0"),b.imageHeight=parseInt(b.getElAttribute(h,"height")||"0"),b.imageUrl=g.compactUrl(b.relativeTo?b.relativeTo:e,k),console.log("Tileset source: "+b.imageUrl),new i.ImageResource(b.imageUrl).fetch().then(function(c){b.image=c,b.imageWidth=b.image.data.width,b.imageHeight=b.image.data.height;for(var d=b.imageWidth/b.tilewidth,e=b.imageHeight/b.tileheight,f=d*e,g=new Array(f),h=0;f>h;h++)g[h]=!1;_.each(b.tiles,function(a){g[a.id]=a.properties}),b.tiles=g,a(b)})["catch"](function(a){c("Failed to load required TileMap image: "+k+" - "+a)})})},b.prototype.hasGid=function(a){return-1!==this.firstgid&&a>=this.firstgid&&a<this.firstgid+this.tiles.length},b.prototype.getTileMeta=function(a){var b=-1!==this.firstgid?a-this.firstgid:a,c=this.imageWidth/this.tilewidth,d=b%c,e=Math.floor((b-d)/c);return _.extend(this.tiles[b]||{},{image:this.image,url:this.imageUrl,x:d*this.tilewidth,y:e*this.tileheight,width:this.tilewidth,height:this.tileheight})},b}(h.XMLResource);return b.TiledTSXResource=k,d.define=e,c.exports}),System.registerDynamic("pow-core/resources/tiled/tiledTmx.js",["pow-core/errors.js","pow-core/resources/tiled/tiled.js","pow-core/resources/xml.js","pow-core/resources/tiled/tiledTsx.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=a("pow-core/errors.js"),h=a("pow-core/resources/tiled/tiled.js"),i=a("pow-core/resources/xml.js"),j=a("pow-core/resources/tiled/tiledTsx.js"),k=function(a){function b(){a.apply(this,arguments),this.width=0,this.height=0,this.orientation="orthogonal",this.tileheight=16,this.tilewidth=16,this.version=1,this.properties={},this.tilesets={},this.layers=[],this.xmlHeader='<?xml version="1.0" encoding="UTF-8"?>'}return f(b,a),b.prototype.write=function(){var a=this,b=$("<map/>");return h.setElAttribute(b,"version",this.version),h.setElAttribute(b,"orientation",this.orientation),h.setElAttribute(b,"width",this.width),h.setElAttribute(b,"height",this.height),h.setElAttribute(b,"tilewidth",this.tilewidth),h.setElAttribute(b,"tileheight",this.tileheight),h.writeTiledProperties(b,this.properties),_.each(this.tilesets,function(a){if(!a.literal)throw new Error("Add support for inline TSX writing");if(!a.firstgid)throw new Error(g.errors.INVALID_ITEM);var c=$("<tileset/>");c.attr("firstgid",a.firstgid),c.attr("source",a.literal),b.append(c)}),_.each(this.layers,function(c){var d=null;if("undefined"!=typeof c.data){d=$("<layer/>"),h.writeITiledObjectBase(d,c);var e=$("<data/>"),f=a.width*a.height;if(c.data.length!=f)throw new Error(g.errors.INVALID_ITEM);e.attr("encoding","csv"),e.text(c.data.join(",")),d.append(e)}else{if("undefined"==typeof c.objects)throw new Error(g.errors.INVALID_ITEM);d=$("<objectgroup/>"),_.each(c.objects,function(a){var b=$("<object/>");h.writeITiledObjectBase(b,a),h.writeTiledProperties(b,a.properties),d.append(b)})}h.writeITiledLayerBase(d,c),b.append(d)}),this.xmlHeader+h.xml2Str(b[0])},b.prototype.load=function(a){var b=this;return this.data=a||this.data,new Promise(function(a,c){b.$map=b.getRootNode("map"),b.version=parseInt(b.getElAttribute(b.$map,"version")),b.width=parseInt(b.getElAttribute(b.$map,"width")),b.height=parseInt(b.getElAttribute(b.$map,"height")),b.orientation=b.getElAttribute(b.$map,"orientation"),b.tileheight=parseInt(b.getElAttribute(b.$map,"tileheight")),b.tilewidth=parseInt(b.getElAttribute(b.$map,"tilewidth")),b.properties=h.readTiledProperties(b.$map);var d=[],e=b.getChildren(b.$map,"tileset"),f=b.url.substr(0,b.url.lastIndexOf("/")+1);_.each(e,function(a){var c=b.getElAttribute(a,"source"),e=parseInt(b.getElAttribute(a,"firstgid")||"-1");c?d.push({source:h.compactUrl(f,c),literal:c,firstgid:e}):d.push({data:a,source:f,firstgid:e})});var g=b.getChildren(b.$map,"layer,objectgroup"),i=!1;if(_.each(g,function(a){if(!i){var d=h.readITiledLayerBase(a);b.layers.push(d);var e=b.getChild(a,"data");if(e){var f=b.getElAttribute(e,"encoding");if(!f||"csv"!==f.toLowerCase())return i=!0,c("pow-core only supports CSV maps.  Edit the Map Properties (for:"+b.url+") to use the CSV");d.data=JSON.parse("["+$.trim(e.text())+"]")}var g=b.getElAttribute(a,"color");g&&(d.color=g);var j=b.getChildren(a,"object");j&&(d.objects=[],_.each(j,function(a){d.objects.push(h.readITiledObject(a))}))}}),!i){var k=function(){if(d.length<=0)return a(b);var e=d.shift();e.data?(new j.TiledTSXResource).load(e.data).then(function(a){a.relativeTo=f,a.firstgid=e.firstgid,b.tilesets[a.name]=a,k()})["catch"](function(a){return c(a)}):e.source?(new j.TiledTSXResource).fetch(e.data).then(function(a){b.tilesets[a.name]=a,a.firstgid=e.firstgid,a.literal=e.literal,k()})["catch"](function(a){return c(a)}):c("Unknown type of tile set data")};k()}})},b}(i.XMLResource);return b.TiledTMXResource=k,d.define=e,c.exports}),System.registerDynamic("pow-core/resources/audio.js",["pow-core/resource.js","pow-core/errors.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=a("pow-core/resource.js"),h=a("pow-core/errors.js"),i=function(a){function b(){a.apply(this,arguments),this._source=null,this._audio=null,this._volume=.8}return f(b,a),b.supportedFormats=function(){var a=this,c=window,d=c.AudioContext||c.webkitAudioContext;if(null===b._context&&d&&(b._context=new d),null===b._types){this._types=[];var e=document.createElement("audio");if(e.canPlayType)try{e.canPlayType("audio/wav;"),_.each(this.FORMATS,function(b){var c=b[1],d=b[0];_.each(c,function(b){e.canPlayType(b)&&a._types.push({extension:d,type:b})})})}catch(f){}}return this._types.slice()},b.prototype.fetch=function(a){this.url=a||this.url;var c=b.supportedFormats(),d=c.length;if(0===d)return Promise.reject(h.errors.UNSUPPORTED_OPERATION);var e=document.createElement("audio");return b._context&&(this._source=b._context.createMediaElementSource(e),this._source)?this._loadAudioBuffer(c):this._loadAudioElement(c)},b.prototype.play=function(a){return void 0===a&&(a=0),this._source&&this._source.start(a),this},b.prototype.pause=function(){return this._source?this._source.stop(0):this._audio,this},Object.defineProperty(b.prototype,"volume",{get:function(){return this._volume},set:function(a){this._volume=a},enumerable:!0,configurable:!0}),b.prototype._loadAudioBuffer=function(a){var c=this;return new Promise(function(d,e){var f=a.slice(),g=function(){if(0===f.length)return e("no sources");var a=c.url+"."+f.shift().extension,h=new XMLHttpRequest;h.open("GET",a,!0),h.responseType="arraybuffer",h.onload=function(){b._context.decodeAudioData(h.response,function(a){var e=b._context.createBufferSource();e.buffer=a,e.connect(b._context.destination),c._source=e,d(c)},g)},h.send()};g()})},b.prototype._loadAudioElement=function(a){var c=this;return new Promise(function(d,e){var f=a.length,g=[],h=function(a){f--,g.push(a),0>=f&&e("No valid sources at the following URLs\n   "+g.join("\n   "))};if(0===f)return e("no supported media types");var i=document.createElement("audio");b._context&&(c._source=b._context.createMediaElementSource(i)),i.addEventListener("canplaythrough",function(){c.data=i,c._audio=i,d(c)}),_.each(a,function(a){var b=document.createElement("source");b.addEventListener("error",function(){console.log("source failed: "+b.src),h(b.src)}),b.type=a.type.substr(0,a.type.indexOf(";")),b.src=c.url+"."+a.extension,i.appendChild(b)}),i.load()})},b.FORMATS=[["mp3",["audio/mpeg;"]],["m4a",["audio/x-m4a;"]],["aac",["audio/mp4a;","audio/mp4;"]],["ogg",['audio/ogg; codecs="vorbis"']],["wav",['audio/wav; codecs="1"']]],b._context=null,b._types=null,b}(g.Resource);return b.AudioResource=i,d.define=e,c.exports}),System.registerDynamic("pow-core/resourceLoader.js",["pow-core/errors.js","pow-core/resources/image.js","pow-core/resources/script.js","pow-core/resources/json.js","pow-core/resources/xml.js","pow-core/resources/entities.js","pow-core/resources/tiled/tiledTmx.js","pow-core/resources/tiled/tiledTsx.js","pow-core/resources/audio.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=a("pow-core/errors.js"),g=a("pow-core/resources/image.js"),h=a("pow-core/resources/script.js"),i=a("pow-core/resources/json.js"),j=a("pow-core/resources/xml.js"),k=a("pow-core/resources/entities.js"),l=a("pow-core/resources/tiled/tiledTmx.js"),m=a("pow-core/resources/tiled/tiledTsx.js"),n=a("pow-core/resources/audio.js"),o=function(){function a(){this._cache={},this._types={png:g.ImageResource,js:h.ScriptResource,json:i.JSONResource,xml:j.XMLResource,entities:k.EntityContainerResource,tmx:l.TiledTMXResource,tsx:m.TiledTSXResource,"":n.AudioResource}}return a.prototype.registerType=function(a,b){this._types[a]=b},a.prototype.getResourceExtension=function(a){var b=a.lastIndexOf(".");return-1===b||b<=a.lastIndexOf("/")?"":a.substr(b+1)},a.prototype.create=function(a,b){if("function"!=typeof a)throw new Error(f.errors.INVALID_ARGUMENTS);var c=new a(null,b);return c},a.prototype.loadAsType=function(a,b){var c=this;return new Promise(function(d,e){if(!a||!b)return e(f.errors.INVALID_ARGUMENTS);var g=c._cache[a];return g&&g.data?d(g):(g||(g=c._cache[a]=new b(a,null)),void g.fetch().then(function(){return d(g)})["catch"](function(a){return e(a)}))})},a.prototype.load=function(a){var b=this;return new Promise(function(c,d){function e(){return 0===g?0===h?c(f):d(h+" resources failed to load"):void 0}var f=[],g=0,h=0;_.isArray(a)||(a=[a]);for(var i=0;i<a.length;i++){var j=a[i],k=b.getResourceExtension(j),l=b._types[k];l?(g++,b.loadAsType(j,b._types[k]).then(function(a){g--,e(),a.extension=k,f.push(a)})["catch"](function(a){console.log("failed to load resource with error: "+a),h++,g--,e()})):h++}e()})},a}();return b.ResourceLoader=o,d.define=e,c.exports}),System.registerDynamic("pow-core/time.js",[],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=null,g=function(){function a(){this.tickRateMS=32,this.mspf=0,this.world=null,this.lastTime=0,this.time=0,this.running=!1,this.objects=[],this.polyFillAnimationFrames()}return a.get=function(){return f||(f=new a),f},a.prototype.start=function(){var a=this;if(!this.running){this.running=!0;var b=function(c){if(a.running){a.time=Math.floor(c);var d=(new Date).getMilliseconds(),e=Math.floor(c-a.lastTime);e>=a.tickRateMS&&(a.lastTime=c,a.tickObjects(e)),a.processFrame(e),a.mspf=(new Date).getMilliseconds()-d,window.requestAnimationFrame(b)}};b(0)}},a.prototype.stop=function(){this.running=!1},a.prototype.removeObject=function(a){this.objects=_.reject(this.objects,function(b){return b._uid===a._uid})},a.prototype.addObject=function(a){a._uid||(a._uid=_.uniqueId("u")),_.where(this.objects,{
_uid:a._uid}).length>0||this.objects.push(a)},a.prototype.tickObjects=function(a){for(var b=this.objects,c=b.length-1;c>=0;--c)b[c].tick&&b[c].tick(a)},a.prototype.processFrame=function(a){for(var b=this.objects,c=b.length-1;c>=0;--c)b[c].processFrame&&b[c].processFrame(a)},a.prototype.polyFillAnimationFrames=function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length;c++){if(window.requestAnimationFrame)return;window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=function(){b(c+d)},f=window.setTimeout(e,d);return a=c+d,f})},a}();return b.Time=g,d.define=e,c.exports}),System.registerDynamic("pow-core/world.js",["pow-core/time.js","pow-core/resourceLoader.js"],!0,function(a,b,c){var d=this,e=d.define;d.define=void 0;var f=a("pow-core/time.js"),g=a("pow-core/resourceLoader.js"),h=function(){function a(a){var b=this;this.loader=null,a=_.defaults(a||{},{loader:new g.ResourceLoader,time:f.Time.get()}),_.extend(this,a),_.each(a,function(a){return b.mark(a)})}return a.prototype.setService=function(a,b){return this.mark(b),this[a]=b,b},a.prototype.mark=function(a){a&&(a.world=this,a.onAddToWorld&&a.onAddToWorld(this))},a.prototype.erase=function(a){a&&(a.onRemoveFromWorld&&a.onRemoveFromWorld(this),delete a.world)},a}();return b.World=h,d.define=e,c.exports}),System.registerDynamic("pow-core/all.js",["pow-core/api.js","pow-core/component.js","pow-core/entity.js","pow-core/errors.js","pow-core/observable.js","pow-core/point.js","pow-core/rect.js","pow-core/resource.js","pow-core/resourceLoader.js","pow-core/time.js","pow-core/world.js","pow-core/resources/audio.js","pow-core/resources/entities.js","pow-core/resources/image.js","pow-core/resources/json.js","pow-core/resources/script.js","pow-core/resources/xml.js","pow-core/resources/tiled/tiled.js","pow-core/resources/tiled/tiledTmx.js","pow-core/resources/tiled/tiledTsx.js"],!0,function(a,b,c){function d(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}var e=this,f=e.define;return e.define=void 0,d(a("pow-core/api.js")),d(a("pow-core/component.js")),d(a("pow-core/entity.js")),d(a("pow-core/errors.js")),d(a("pow-core/observable.js")),d(a("pow-core/point.js")),d(a("pow-core/rect.js")),d(a("pow-core/resource.js")),d(a("pow-core/resourceLoader.js")),d(a("pow-core/time.js")),d(a("pow-core/world.js")),d(a("pow-core/resources/audio.js")),d(a("pow-core/resources/entities.js")),d(a("pow-core/resources/image.js")),d(a("pow-core/resources/json.js")),d(a("pow-core/resources/script.js")),d(a("pow-core/resources/xml.js")),d(a("pow-core/resources/tiled/tiled.js")),d(a("pow-core/resources/tiled/tiledTmx.js")),d(a("pow-core/resources/tiled/tiledTsx.js")),e.define=f,c.exports});
//# sourceMappingURL=pow-core.min.map